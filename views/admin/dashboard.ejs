<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin ‚Äì Popt√°vky | Vy≈°≈°√≠Cena</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 text-slate-900">
  <!-- Header (mobil p≈ôehlednƒõ) -->
  <header class="bg-white border-b">
    <div class="mx-auto max-w-6xl px-4 py-2 flex items-center justify-between gap-2">
      <div class="flex items-center gap-2 min-w-0">
        <img src="/logo.svg" alt="Vy≈°≈°√≠Cena" class="h-7 w-auto shrink-0">
      </div>
      <nav class="flex items-center gap-2 md:gap-3 shrink-0">
        <a href="/" class="text-xs md:text-sm text-slate-600 hover:text-slate-900">Ve≈ôejn√Ω web</a>
        <a href="/admin/logout" class="text-xs md:text-sm px-2 md:px-3 py-1.5 rounded-lg border hover:bg-slate-50">Odhl√°sit</a>
      </nav>
    </div>
  </header>

  <main class="mx-auto max-w-6xl px-4 py-6 md:py-8">
    <div class="mb-4 md:mb-6 flex items-center justify-between gap-3">
      <h1 class="text-xl md:text-2xl font-bold">Popt√°vky</h1>
      <div class="text-xs md:text-sm text-slate-500"><%= leads?.length || 0 %> z√°znam≈Ø</div>
    </div>

    <!-- Mobil: horizont√°ln√≠ scroll tabulky -->
    <div class="bg-white border rounded-2xl overflow-hidden">
      <div class="overflow-x-auto"> <!-- üëà tohle vrac√≠ vodorovn√Ω scroll na mobilu -->
        <table class="min-w-[820px] md:min-w-full text-sm">
          <thead class="bg-slate-50 border-b text-slate-600">
            <tr>
              <th class="text-left py-3 px-3">ID</th>
              <th class="text-left py-3 px-3">Jm√©no</th>
              <th class="text-left py-3 px-3">Typ</th>
              <th class="text-left py-3 px-3">Mƒõsto</th>
              <th class="text-left py-3 px-3">PSƒå</th>
              <th class="text-left py-3 px-3">Plocha</th>
              <th class="text-left py-3 px-3">Vytvo≈ôeno</th>
              <th class="text-left py-3 px-3">Stav</th>
              <th class="text-left py-3 px-3">Balkon</th>
              <th class="text-right py-3 px-3">Zavol√°no</th>
            </tr>
          </thead>

          <tbody>
            <% if (!leads || leads.length === 0) { %>
              <tr>
                <td colspan="8" class="py-10 text-center text-slate-500">
                  Zat√≠m ≈æ√°dn√© popt√°vky.
                </td>
              </tr>
            <% } %>

            <% leads.forEach(lead => { %>
              <!-- Klikac√≠ ≈ô√°dek (kromƒõ posledn√≠ bu≈àky se switch/checkboxem) -->
              <tr
                data-href="/admin/leads/<%= lead.id %>"
                class="border-b last:border-0 hover:bg-slate-50 transition cursor-pointer"
              >
                <td class="py-3 px-3 font-medium text-slate-800"><%= lead.id %></td>
                <td class="py-3 px-3"><%= lead.first_name %> <%= lead.last_name %></td>
                <td class="py-3 px-3 uppercase"><%= lead.type %></td>
                <td class="py-3 px-3"><%= lead.city %></td>
                <td class="py-3 px-3"><%= lead.psc %></td>
                <td class="py-3 px-3">
                  <%= lead.area %> m¬≤
                  <% if (lead.layout) { %>
                    , <span class="text-slate-500"><%= lead.layout %></span>
                  <% } %>
                </td>
                <td class="py-3 px-3 text-slate-500">
                  <%= new Date(lead.created_at).toLocaleString('cs-CZ') %>
                </td>
                <td class="py-3 px-3"><%= lead.condition || '‚Äî' %></td>
                <td class="py-3 px-3"><% if (lead.type === 'byt' && lead.balcony) { %><%= lead.balcony %><% } else { %>neobsahuje<% } %></td>
 

                <!-- Prav√° strana: kulat√Ω zelen√Ω checkbox; neklikateln√° oblast ≈ô√°dku -->
                <td class="py-3 px-3">
                  <form
                    action="/admin/leads/<%= lead.id %>/contacted"
                    method="POST"
                    class="w-full flex items-center justify-end no-rowlink"
                  >
                    <input
                      type="checkbox"
                      aria-label="Zavol√°no"
                      onchange="this.form.submit()"
                      <%= lead.contacted ? 'checked' : '' %>
                      class="h-6 w-6 appearance-none rounded-full border-2 border-slate-300
                             cursor-pointer transition-all duration-200
                             checked:bg-green-500 checked:border-green-500
                             hover:border-green-400 focus:ring-2 focus:ring-green-300"
                    />
                  </form>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    </div>
  </main>

  <script>
    // Klikac√≠ ≈ô√°dky ‚Üí p≈ôechod na detail; ignoruj klik uvnit≈ô .no-rowlink (checkbox/form)
    document.querySelectorAll('tr[data-href]').forEach(row => {
      row.addEventListener('click', (e) => {
        if (e.target.closest('.no-rowlink')) return;
        const href = row.getAttribute('data-href');
        if (href) window.location.href = href;
      });
    });
  </script>
</body>
</html>
